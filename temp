
#Область ПрограммныйИнтерфейс

// Функция сравнивает 2 таблицы
//
// Параметры:
//  ПерваяТаблица  - ТаблицаЗначений - Первая таблица
//  ВтораяТаблица  - ТаблицаЗначений - Вторая таблица
//
// Возвращаемое значение:
//  ТаблицаЗначений   - Возвращаяется разница сравнения 2 таблиц, 
//  					так же добавляется дополнительная колонка "Знак" (Число 1,0)
//							0 - строка из первой таблицы
//							1 - строка из второй таблицы
Функция РазницаТаблиц(ПерваяТаблица, ВтораяТаблица, Метод = Неопределено) Экспорт 
	
	Если Метод = МетодыСравненияТаблиц().СверткаСортировка Тогда
		
		Возврат СверткаСортировка(ПерваяТаблица, ВтораяТаблица); 
		
	ИначеЕсли Метод = МетодыСравненияТаблиц().ТрюкСверткаСортировка Тогда
		
		Возврат СверткаСортировка(ПерваяТаблица, ВтораяТаблица); 
		
	ИначеЕсли Метод = Неопределено Тогда
	
		Возврат СверткаСортировка(ПерваяТаблица, ВтораяТаблица); 
	
	КонецЕсли;
	
КонецФункции

Функция МетодыСравненияТаблиц() Экспорт
	
	Структура = Новый Структура;
	Структура.Вставить("СверткаСортировка",		"СверткаСортировка");
	Структура.Вставить("ТрюкСверткаСортировка", "ТрюкСверткаСортировка");
	
	Возврат Новый ФиксированнаяСтруктура(Структура);
	
КонецФункции

#Область МетодыСравнения

Функция СверткаСортировка(ПерваяТаблица, ВтораяТаблица) Экспорт
	
	КолонкиСтрокой = КолонкиТаблицыСтрокой(ПерваяТаблица);
	ОписаниеЧисла = Новый ОписаниеТипов("Число", Новый КвалификаторыЧисла(1, 0, ДопустимыйЗнак.Любой));
	
	ПромежуточнаяТаблица = ВтораяТаблица.Скопировать();
	ПромежуточнаяТаблица.Колонки.Добавить("Знак", ОписаниеЧисла);
	ПромежуточнаяТаблица.ЗаполнитьЗначения(1, "Знак");
	
	Для Каждого Строка Из ПерваяТаблица Цикл 
		ЗаполнитьЗначенияСвойств(ПромежуточнаяТаблица.Добавить(), Строка);
	КонецЦикла;
	
	ПромежуточнаяТаблица.Колонки.Добавить("Счёт");
	ПромежуточнаяТаблица.ЗаполнитьЗначения(1, "Счёт");
	
	ПромежуточнаяТаблица.Свернуть(КолонкиСтрокой, "Знак, Счёт");
	
	Результат = ПромежуточнаяТаблица.Скопировать(Новый Структура("Счёт", 1), КолонкиСтрокой + ", Знак");
	
	Возврат Результат;	
	
КонецФункции 

Функция ТрюкСверткаСортировка(ПерваяТаблица, ВтораяТаблица) Экспорт

	

КонецФункции

#КонецОбласти

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

Функция КолонкиТаблицыСтрокой(Таблица, Разделитель = ",")

	КолонкиСтрокой = "";
	
	Для Каждого Колонка Из Таблица.Колонки Цикл 
		КолонкиСтрокой = КолонкиСтрокой + Разделитель + Колонка.Имя
	КонецЦикла;
	
	КолонкиСтрокой = Сред(КолонкиСтрокой, 2);
	
	Возврат КолонкиСтрокой;
	
КонецФункции 

#КонецОбласти


